JavaScript 中的函数就是一种特殊的对象，我们把 JavaScript 中的函数称为一等公民 (First Class Function)。

在 JavaScript 中，可以将一个函数赋值给一个变量，还可以将函数作为一个参数传递给另外一个函数，甚至可以使得一个函数返回另外一个函数。因此 JavaScript 非常容易实现一些特性，比如闭包，还有函数式编程等。

## 什么是 JavaScript 中的对象

JavaScript 是一门基于对象 (Object-Based) 的语言，这些对象在运行时可以动态修改其内容，这造就了 JavaScript 的超级灵活特性。

JavaScript 在对象中添加了一个称为原型的属性，把继承的对象通过原型链接起来实现继承，称为基于原型链继承。

JavaScript 中的对象就是由一组组属性和值构成的集合，对象的值可以是任意类型的数据。

对象的属性值有三种类型：

1. 原始类型 (primitive)，值本身无法被改变，例如修改了一个字符串的值，V8 会返回一个新的字符串，原始字符串并没有被改变。
2. 对象类型 (Object)，对象的属性值也可以是另外一个对象。
3. 函数类型 (Function)，如果对象中的属性值是函数，把这个属性称为方法。

## 函数的本质

在 JavaScript 中，函数是一种特殊的对象，它和对象一样可以拥有属性和值，不同的是函数可以被调用。

在 V8 内部，会为函数对象添加了两个隐藏属性：

![](https://blog-1252173264.cos.ap-shanghai.myqcloud.com/1675510629757-f48f0103-7eca-4d38-943b-e621abd57434.png)

函数对象默认的 name 属性值是 anonymous，表示该函数对象没有被设置名称。code 属性的值表示函数代码，以字符串的形式存储在内存中。当执行到一个函数调用语句时，V8 便会从函数对象中取出 code 属性值，也就是函数代码，然后再解释执行这段函数代码。

## 函数是一等公民

函数是一种特殊的对象，在 JavaScript 中，函数可以赋值给一个变量，也可以作为函数的参数，还可以作为函数的返回值。**如果某个编程语言的函数，可以和这个语言的数据类型做一样的事情，就把这个语言中的函数称为一等公民。**

---

在执行 JavaScript 函数的过程中，为了实现变量的查找，V8 会为其维护一个作用域链，如果函数中使用了某个变量，但是在函数内部又没有定义该变量，那么函数就会沿着作用域链去外部的作用域中查找该变量，具体流程如下图所示：

![](https://blog-1252173264.cos.ap-shanghai.myqcloud.com/1675511795149-eb28241a-e309-4468-964a-32124de474f6.png)

当函数内部引用了外部的变量时，使用这个函数进行赋值、传参或作为返回值，你还需要保证这些被引用的外部变量是确定存在的，这就是让函数作为一等公民麻烦的地方，因为虚拟机还需要处理函数引用的外部变量。

在 foo 函数中定义了一个新的 bar 函数，并且 bar 函数引用了 foo 函数中的变量 test，当调用 foo 函数的时候，它会返回 bar 函数。那么所谓的“函数是一等公民”就体现在，如果要返回函数 bar 给外部，那么即便 foo 函数执行结束了，其内部定义的 test 变量也不能被销毁，因为 bar 函数依然引用了该变量。

**我们也把这种将外部变量和和函数绑定起来的技术称为闭包。**

---
