## 摘要算法

实现完整性的手段主要是摘要算法（Digest Algorithm），也就是常说的散列函数、哈希函数（Hash Function）。摘要算法近似一种特殊的压缩算法，它能够把任意长度的数据压缩成固定长度、而且独一无二的摘要字符串，就好像是给这段数据生成了一个数字指纹。

MD5（Message-Digest 5）、SHA-1（Secure Hash Algorithm 1）是最常用的两个摘要算法，能够生成 16 字节和 20 字节长度的数字摘要。但这两个算法的安全强度比较低，不够安全，在 TLS 里已经被禁止使用了。

SHA-2：一系列摘要算法的统称，总共有 6 种，常用的有 SHA224、SHA256、SHA384，分别能够生成 28 字节、32 字节、48 字节的摘要。

## 完整性

![](https://blog-1252173264.cos.ap-shanghai.myqcloud.com/1653733209443-a48a440b-08d4-4e73-b547-1ec15a50813a.png)

## 数字签名

把公钥私钥的用法反过来，之前是公钥加密、私钥解密，现在是私钥加密、公钥解密。私钥只加密原文的摘要，这样运算量就小的多，而且得到的数字签名也很小，方便保管和传输。

签名和公钥一样完全公开，任何人都可以获取。但这个签名只有用私钥对应的公钥才能解开，拿到摘要后，再比对原文验证完整性。

![](https://blog-1252173264.cos.ap-shanghai.myqcloud.com/1653733413316-e4e1ae30-4a61-4b79-b746-095e9a0ab326.png)

## 数字证书和 CA

CA（Certificate Authority，证书认证机构），具有极高的可信度，由它来给各个公钥签名，用自身的信誉来保证公钥无法伪造，是可信的。CA 对公钥的签名认证格式，包含序列号、用途、颁发者、有效时间等等，把这些打成一个包再签名，完整地证明公钥关联的各种信息，形成数字证书（Certificate）。

操作系统和浏览器都内置了各大 CA 的根证书，上网的时候只要服务器发过来它的证书，就可以验证证书里的签名，顺着证书链（Certificate Chain）一层层地验证，直到找到根证书，就能够确定证书是可信的，从而里面的公钥也是可信的。

## 证书体系的弱点

- CA 失误或者被欺骗，签发了错误的证书：CRL（证书吊销列表，Certificate revocation list）和 OCSP（在线证书状态协议，Online Certificate Status Protocol），及时废止有问题的证书
- CA 被黑客攻陷，或者 CA 有恶意：操作系统或者浏览器从根上撤销对 CA 的信任，列入黑名单
